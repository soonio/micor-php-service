#!/usr/bin/env bash

#åˆ¤æ–­å½“å‰æ˜¯å¦å·²æœ‰tag
hasTag=$(git rev-list --tags --max-count=1)
if [ "$hasTag" ]; then
  echo "Current tag: $(git describe --tags "$(git rev-list --tags --max-count=1)")"
else
  echo -e "\033[31mNo first tag.\033[0m"
fi

# è®¾ç½®æ–°TAG
echo -n "Entry new tag: "
read -r version

if [ "$version" ]; then
  echo "New tag: $version"
  git tag "$version"
  git push origin --tag
else
  echo -e "\033[33mEmpty tag...\nOnly build old version.\033[0m"
fi

hasTag=$(git rev-list --tags --max-count=1)
if [ "$hasTag" ]; then
  ## æ— æ–°ä»£ç æäº¤ï¼Œç‰ˆæœ¬å·ä¸ä¼šå‘ç”Ÿå˜åŒ–
  box compile -q
  echo -e "\033[32mğŸš€Compile completed.\033[0m"
else
  echo -e "\033[31mNo git tag, unable compile.\033[0m"
fi

exit 0
